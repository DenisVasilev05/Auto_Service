{% extends 'base.html' %}
{% load static %}
{% block title %}My Appointments{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">My Appointments</h1>

  {% if is_technician %}
    <h3 class="mt-3">Upcoming / In-Progress</h3>
    <div class="list-group mb-4">
      {% for appt in upcoming_appointments %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">{{ appt.service_type.name }}</h6>
            <small class="text-muted">
              {{ appt.scheduled_date }} {{ appt.scheduled_time }} •
              {{ appt.vehicle.make }} {{ appt.vehicle.model }} ({{ appt.vehicle.license_plate }})
            </small>
          </div>
          <span class="badge bg-info text-dark">{{ appt.get_status_display }}</span>
        </div>
      {% empty %}
        <p class="text-muted">No upcoming appointments.</p>
      {% endfor %}
    </div>

    <h3 class="mt-3">Past (Completed)</h3>
    <div class="list-group">
      {% for appt in past_appointments %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">{{ appt.service_type.name }}</h6>
            <small class="text-muted">{{ appt.scheduled_date }} {{ appt.scheduled_time }}</small>
          </div>
          <span class="badge bg-success">Completed</span>
        </div>
      {% empty %}
        <p class="text-muted">No past appointments yet.</p>
      {% endfor %}
    </div>

  {% else %}
    <h3 class="mt-3">Upcoming</h3>
    <div class="list-group mb-4">
      {% for appt in upcoming_appointments %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">{{ appt.service_type.name }}</h6>
            <small class="text-muted">{{ appt.scheduled_date }} {{ appt.scheduled_time }} • {{ appt.vehicle.make }} {{ appt.vehicle.model }}</small>
          </div>
          <a href="{% url 'service:appointment_cancel' appt.id %}" class="btn btn-sm btn-outline-danger"{% if appt.status != 'SCHEDULED' %} style="display:none;"{% endif %}>Cancel</a>
        </div>
      {% empty %}
        <p class="text-muted">No upcoming appointments.</p>
      {% endfor %}
    </div>

    <h3 class="mt-3">Past Services</h3>
    <div class="list-group">
      {% for appt in past_appointments %}
        <div class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <h6 class="mb-1">{{ appt.service_type.name }}</h6>
            <small class="text-muted">{{ appt.scheduled_date }} {{ appt.scheduled_time }} • {{ appt.vehicle.make }} {{ appt.vehicle.model }}</small>
          </div>
          <span class="badge bg-secondary">{{ appt.get_status_display }}</span>
        </div>
      {% empty %}
        <p class="text-muted">No past services yet.</p>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %} 